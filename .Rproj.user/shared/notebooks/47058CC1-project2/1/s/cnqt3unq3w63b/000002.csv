"0","#function"
"0","class_diag<-function(probs,truth){"
"0"," tab<-table(factor(probs>.5,levels=c(""FALSE"",""TRUE"")),truth)"
"0"," acc=sum(diag(tab))/sum(tab)"
"0"," sens=tab[2,2]/colSums(tab)[2]"
"0"," spec=tab[1,1]/colSums(tab)[1]"
"0"," ppv=tab[2,2]/rowSums(tab)[2]"
"0"," if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1"
"0"," #CALCULATE EXACT AUC"
"0"," ord<-order(probs, decreasing=TRUE)"
"0"," probs <- probs[ord]; truth <- truth[ord]"
"0"," TPR=cumsum(truth)/max(1,sum(truth))"
"0"," FPR=cumsum(!truth)/max(1,sum(!truth))"
"0"," dup<-c(probs[-1]>=probs[-length(probs)], FALSE)"
"0"," TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)"
"0"," n <- length(TPR)"
"0"," auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )"
"0"," data.frame(acc,sens,spec,ppv,auc)"
"0","} "
"0",""
"0","#CV 10 fold"
"0","set.seed(1234)"
"0","k=10 "
"0","visitscv<-visits[sample(nrow(visits)),] "
"0","folds<-cut(seq(1:nrow(visits)),breaks=k,labels=F) "
"0","diags<-NULL"
"0","for(i in 1:k){"
"0",""
"0"," train<-visitscv[folds!=i,]"
"0"," test<-visitscv[folds==i,]"
"0"," truth<-test$adldiff"
"0",""
"0"," fit5<-glm(adldiff~ofp+faminc,data=train,family=""binomial"")"
"0"," probs<-predict(fit5,newdata = test,type=""response"")"
"0",""
"0"," diags<-rbind(diags,class_diag(probs,truth))"
"0","}"
"0","apply(diags,2,mean) "
"1","        acc "
"1","       sens "
"1","       spec "
"1","        ppv "
"1","
"
"1","0.794836116 "
"1","0.008991227 "
"1","0.996312405 "
"1","        NaN "
"1","
"
"1","        auc "
"1","
"
"1","0.625437875 "
"1","
"
